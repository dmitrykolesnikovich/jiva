// https://featurea.myjetbrains.com/youtrack/issue/ENGINE-47
// Run `gw featurea:standard:test3`

subprojects {

    afterEvaluate { project ->
        String mainPath = project.path
        String draftPath = "${mainPath}-draft"
        Project draftProject = findProject(draftPath)

        if (draftProject != null) {
            draftProject.ext.mainCall = { String main ->
                // quickfix todo improve
            }
            String[] fileNames = new File(draftProject.projectDir, "draft").list()
            if (fileNames != null) {
                for (String fileName : fileNames) {
                    String taskName = fileName.replace(".kt", "")
                    project.tasks.register(taskName) {
                        doLast {
                            String packageId = project.packageId.replace(".standard", "")
                            println("[draft.gradle] mainCall by $draftProject is '${packageId}.${taskName}()'")
                        }
                    }
                }
            }
        }
    }

}
